--CREAMOS LAS TABLAS CON LAS REFERENCIAS
CREATE TABLE HOSPITALES(
    CCN INTEGER(10) PRIMARY KEY,
    CNH INTEGER(6),
    NOMBRE NVARCHAR(40),
    COMUNIDAD_AUTONOMA NVARCHAR(40),
    PROVINCIA VARCHAR(20),
    MUNICIPIO VARCHAR(20),
    DIRECCION NVARCHAR(40),
    CODIGO_POSTAL INTEGER(5),
    TELEFONO INTEGER(10),
    NUMERO_DE_CAMAS INTEGER(5),
    TIPO_DE_CENTRO VARCHAR(40),
    DEPENDENCIA VARCHAR(40),
    OBSERVACIONES NVARCHAR(5),
    CONCIERTO VARCHAR(5),
    ACREDITACION_DOCENTE VARCHAR(2)
);

CREATE TABLE EQUIPO_MEDICO(
    COMUNIDAD_AUTONOMA NVARCHAR(40) REFERENCES HOSPITALES(COMUNIDAD_AUTONOMA),
    TAC INTEGER(4),
    RM INTEGER(4),
    GAM INTEGER(4),
    HEM INTEGER(4),
    ASD INTEGER(4),
    LIT INTEGER(4),
    BCO INTEGER(4),
    ALI INTEGER(4),
    SPECT INTEGER(4),
    PET INTEGER(4),
    MAMOS INTEGER(4),
    DEN_O INTEGER(4),
    DIAL INTEGER(4)
);

CREATE TABLE GASTO_SANIDAD(
    COMUNIDAD_AUTONOMA VARCHAR(40) REFERENCES HOPITALES(COMUNIDAD_AUTONOMA),
    GASTO_SANIDAD INTEGER(9)
);

CREATE TABLE POP_MUJERES(
    COMUNIDAD_AUTONOMA VARCHAR(40) REFERENCES HOSPITALES(COMUNIDAD_AUTONOMA),
    NUM_MUJERES INTEGER(9)
);

CREATE TABLE PIB(
    COMUNIDAD_AUTONOMA VARCHAR(40) REFERENCES HOSPITALES(COMUNIDAD_AUTONOMA),
    PIB INTEGER(13)
);

CREATE TABLE POBLACION(
    COMUNIDAD_AUTONOMA VARCHAR(40) REFERENCES HOSPITALES(COMUNIDAD_AUTONOMA),
    POBLACION INTEGER(10),
    SUPERFICIE INTEGER(7),
    DENSIDAD_POP DECIMAL(4,2)
);

--CONSULTAS

--10 HOSPITALES CON MAYOR NUMERO DE CAMAS
SELECT NOMBRE, NUMERO_DE_CAMAS
FROM HOSPITALES
ORDER BY NUMERO_DE_CAMAS DESC
LIMIT 10;

--NUMERO DE MAMOGRAFOS POR MUJERES Y CCAA
SELECT * FROM EQUIPO_MEDICO;
SELECT * FROM POP_MUJERES;

SELECT E.COMUNIDAD_AUTONOMA, MAMOS, NUM_MUJERES
FROM EQUIPO_MEDICO E
JOIN POP_MUJERES M ON E.COMUNIDAD_AUTONOMA = M.COMUNIDAD_AUTONOMA
ORDER BY MAMOS DESC;

SELECT E.COMUNIDAD_AUTONOMA, E.TAC ,P.POBLACION
FROM EQUIPO_MEDICO E
JOIN POBLACION P ON E.COMUNIDAD_AUTONOMA = P.COMUNIDAD_AUTONOMA
ORDER BY E.TAC DESC;

--NUMERO DE CAMAS POR POBLACION Y CCAA (CALIDAD ASISTENCIAL)
SELECT H.COMUNIDAD_AUTONOMA, SUM(H.NUMERO_DE_CAMAS) AS NUMERO_DE_CAMAS, P.POBLACION
FROM HOSPITALES H
JOIN POBLACION P ON H.COMUNIDAD_AUTONOMA = P.COMUNIDAD_AUTONOMA
GROUP BY H.COMUNIDAD_AUTONOMA
ORDER BY P.POBLACION DESC;

SELECT H.COMUNIDAD_AUTONOMA, SUM(H.NUMERO_DE_CAMAS) AS NUMERO_DE_CAMAS, P.POBLACION, PI.PIB 
FROM HOSPITALES H
JOIN POBLACION P ON H.COMUNIDAD_AUTONOMA = P.COMUNIDAD_AUTONOMA
JOIN PIB PI ON P.COMUNIDAD_AUTONOMA = PI.COMUNIDAD_AUTONOMA
GROUP BY H.COMUNIDAD_AUTONOMA
ORDER BY PI.PIB DESC;


SELECT SUM(NUMERO_DE_CAMAS)
FROM HOSPITALES;

SELECT SUM(POBLACION)
FROM POBLACION;

--GASTO EN SANIDAD SOBRE EL PIB
SELECT G.COMUNIDAD_AUTONOMA, G.GASTO_SANIDAD, P.PIB
FROM GASTO_SANIDAD G
JOIN PIB P ON G.COMUNIDAD_AUTONOMA = P.COMUNIDAD_AUTONOMA
GROUP BY G.COMUNIDAD_AUTONOMA;